<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SproutCore Guides: MVC -- The model layer.</title>

  <!-- guides styles -->
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
  <link rel="stylesheet" type="text/css" href="stylesheets/strobe.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/overrides.style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/overrides.print.css" media="print" />
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- syntax highlighting styles -->
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/shThemeStrobeGuides.css" />
</head>
<body class="guide">

  <header role="banner">
    <div class="container">
      <h1 id="logo">
        <a href="http://www.sproutcore.com"><img src="images/header/logo.png" alt="SproutCore" /></a>
      </h1>
      <nav role="navigation">
        <ul>
          <li><a href="http://sproutcore.com/about/">About</a></li>
          <li class="active"><a href="http://sproutcore.com/guides/">Guides</a></li>
          <li><a href="http://sproutcore.com/docs/">Docs</a></li>
          <li><a href="http://sproutcore.com/community/">Community</a></li>
          <li><a href="http://blog.sproutcore.com">Blog</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div id="feature">
    <div class="wrapper">
      <div class="feature_header">
        <a href="/"><img src="images/strobe/guides.png"></a>
        <h2><a href="/">SproutCore Guides</a></h2>
        <p>These guides are designed to help you write and perfect your code.</p>
      </div>
      <div class="feature_sidebar">
        <a href="index.html" id="guidesMenu">
          Guides Index <span id="guidesArrow">&#9656;</span>
        </a>
        <div id="guides" class="clearfix" style="display: none;">
          <a href="index.html" class="guidesMenu">
            Guides Index <span class="guidesArrow">&#9662;</span>
          </a>
          <hr style="clear:both;">
          <dl class="L">
    <dt>Start Here</dt>
      <dd><a href="getting_started.html">Getting Started: Part 1</a></dd>
      <dd><a href="getting_started_2.html">Getting Started: Part 2</a></dd>
      <dd><a href="core_concepts.html">Core Concepts</a></dd>
      <dd><a href="enumerables.html">Enumerables</a></dd>
    <dt>Views</dt>
      <dd><a href="using_handlebars.html">Using Handlebars Templates</a></dd>
      <dd><a href="views.html">Core View Concepts</a></dd>
    <dt>Models</dt>
      <dd><a href="records.html">SproutCore Records</a></dd>
      <dd><a href="fixtures.html">Using Fixtures</a></dd>
    <dt>Theming</dt>
      <dd><a href="chance.html">Using Chance, SproutCore's CSS Framework</a></dd>
      <dd><a href="theming_app.html">Theming Your App</a></dd>
</dl>
<dl class="R">
    <dt>Testing</dt>
      <dd><a href="unit_test_framework.html">Unit Testing</a></dd>
      <dd><a href="adding_unit_test.html">Adding a Unit Test</a></dd>
      <dd><a href="writing_unit_tests.html">Writing Unit Tests</a></dd>
      <dd><a href="running_unit_tests.html">Running Unit Tests</a></dd>
      <dd><a href="todos_tdd.html">SproutCore Development Using TDD</a></dd>
    <dt>Contributing to SproutCore</dt>
      <dd><a href="style_guide.html">Javascript Style Guide</a></dd>
      <dd><a href="commit_code.html">Committer Guidelines</a></dd>
      <dd><a href="documentation_guidelines.html">Documentation Guidelines</a></dd>
</dl>


        </div>
      </div>
    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
          <div class="headerSection">
            <h2><span class="caps">MVC</span> &#8212; The model layer.</h2>
<p>SproutCore includes a powerful model layer, called the datastore. SproutCore has special code in it&#8217;s controller and view layers to make the datastore the most efficient source of data.</p>

          </div>
        
<div class="warning"><p>This is a Draft Copy, and although the information in here is correct, it may be incomplete in places.</p></div>
<p>Nevertheless, you don&#8217;t have to use the datastore in your application. Like most high-quality frameworks, the datastore is an optional framework in SproutCore (though it is &#8220;on&#8221; by default).</p>
<h3 id="how-to-use-sproutcore-without-a-model-layer">1 How To Use SproutCore Without a Model Layer</h3>
<p>This is how you do what backbone.js does in SproutCore. It does not use SproutCore&#8217;s datastore.</p>
<p>See <a href="http://www.jamesyu.org/2011/01/27/cloudedit-a-backbone-js-tutorial-by-example/">http://www.jamesyu.org/2011/01/27/cloudedit-a-backbone-js-tutorial-by-example/</a> for an example.</p>
<div class="code_container">
<div class="filename">apps/my_app/core.js</div>
<pre class="brush: javascript; gutter: false; toolbar: false">

var MyApp = SC.Application.create({

  newTask: function() {
    // optional: clear the values in the fields
    MyApp.newTaskPane.append();
  },

  createTask: function() {
    // 1. Fetch the values from the fields in MyApp.newTaskPane.
    var name = MyApp.newTaskPane.get('nameField'),
        description = MyApp.newTaskPane.get('descriptionField');

    // 2. Send the values to the remote &quot;create&quot; method
    //    (disable interaction)
    SC.Request.postUrl('/tasks')
              .header({ 'Accept': 'application/json' }).json()
              .notify(this, '_didCreateTask').send();
  },

  // 3. When the server responds, create the task and add update
  //    MyApp.tasksController.
  _didCreateTask: function(response, store, storeKey) {
    if (SC.ok(response)) {
      var hash = response.get('body');
      MyApp.Task.create(hash);
    }

    // 4. Show the MyApp.editTaskPane
    MyApp.editTaskPane.append();
  },

  updateTask: function() {
    // 1. Get the values from MyApp.selectedTaskController
    var task = MyApp.selectedTaskController.get('content');

    // 2. Contact the server and send the updated properties
    //    for the task (disable interaction)
    // 3. When the server responds, refresh the task with then
    //    new properties.
    MyApp.editTaskPane.append();
  },

  deleteTask: function() {
    // 1. Search MyApp.tasksController for the task with id = `id`.
    var task = MyApp.selectedTaskController.get('content');

    // 2. Contact the server and ask it delete the task with
    //    id == `id` (disable interaction)
    // 3. When the server responds, delete the task and remove
    //    it from the list.
    MyApp.listTasksPane.append();
  },

  showTaskList: function() {
    // 1. Use SC.Response ajax to contact your server.
    // You can hardcode the url in here:
    SC.Request.getUrl('/tasks').json()
        .notify(this, '_listDidRespond').send();
    MyApp.listTasksPane.append();
  }

  _listDidRespond: function(res) {
    // 2. When you get the response, instatiate MyApp.Task objects
    //    and add them to a new array
    var newArray = [];
    var jsonHashesArray = res.get('body');
    jsonHashesArray.forEach(function(hash) {
        var task = MyApp.Task.create(hash);
        newArray.push(task);
    });

    // 3. Set the new array as the &quot;content&quot;
    MyApp.tasksController.set('content', newArray);
  }

});

//
// Define our model class.
//
MyApp.Task = SC.Object.extend({

  toJSON: function() {
    var hash = {}, key, val;

    for (key in this) {
      if (!this.hasOwnKey(key)) continue;

      val = this[key];
      if (val.isProperty) val = this.get('val');
      hash[key] = this.get(key);
    }
  }

}); // gives us the &quot;create&quot; function.

//
// Make our Task list available to views.
//
MyApp.tasksController = SC.ArrayController.create({

  content: [],
  allowsMultipleSelection: NO,

});

//
// Keeps track of the selected task so we can bind to it in
//our views.
//
MyApp.selectedTaskController = SC.ObjectController.create({

 contentBinding: SC.Binding
                   .single('MyApp.tasksController.selection')

)};

//
// Create a pane to display our task list.
//
MyApp.listTasksPane = SC.MainPane.create({

  contentView: SC.View.create({

    childViews: 'list new'.w(),

    list: SC.ListView.create({
      layout: { centerX:0, top:50, width:300, bottom:100 },

      contentBinding: 'MyApp.tasksController.arrangedObjects',
      selectionBinding: 'MyApp.tasksController.selection'

      actsOnSelect: YES,
      action: 'editTask',
      target: MyApp
    }),

    new: SC.ButtonView.create({
      layout: { centerX:60, height:54, width:90, bottom:50 },
      title: &quot;New Task&quot;,
      action: 'newTask',
      target: MyApp
    })
  })
});

//
// Create a new task pane.
//
MyApp.newTaskPane = SC.MainPane.create({

  nameField: SC.outlet('contentView.form.name'),
  descriptionField: SC.outlet('contentView.form.description'),

  contentView: SC.View.create({

    childViews: 'form new'.w(),

    form: SC.View.create({
      layout: { centerX:0, top:50, width:300, bottom:100 },

      childViews: 'name description'.w(),

      name: SC.TextFieldView.create({
        layout: { top:10, left:10, right:10, height:80 },
        hint: &quot;Enter a task  name&quot;
      }),

      description: SC.TextFieldView.create({
        layout: { top: 100, left: 10, right: 10, bottom: 10 },
        allowsMultipleLines: YES
      })

    }),

    new: SC.ButtonView.create({
      layout: { centerX:60, height:54, width:90, bottom:50 },
      title: &quot;Create&quot;,
      action: 'createTask',
      target: MyApp
    })
  })
});

//
// Create an edit task pane.
//
MyApp.editTaskPane = SC.MainPane.create({

  contentView: SC.View.create({

    childViews: 'form update delete'.w(),

    form: SC.View.create({
      layout: { centerX:0, top:50, width:300, bottom:100 },

      childViews: 'name description'.w(),

      name: SC.TextFieldView.create({
        layout: { top:10, left:10, right:10, height:80 },
        valueBinding: 'MyApp.selectedTaskController.name'
      }),

      description: SC.TextFieldView.create({
        layout: { top: 100, left: 10, right: 10, bottom: 10 },
        allowsMultipleLines: YES,
        valueBinding: 'MyApp.selectedTaskController.description'
      })

    }),

    update: SC.ButtonView.create({
      layout: { right:10, height:54, width:90, bottom:50 },
      title: &quot;Update&quot;,
      action: 'updateTask',
      target: MyApp
    }),

    delete: SC.ButtonView.create({
      layout: { right:120, height:54, width:90, bottom:50 },
      title: &quot;Delete&quot;,
      action: 'deleteTask',
      target: MyApp
    })
  })
});

main() {
  MyApp.showTaskList(); // Puts the list on the screen.
};

</pre></div><h3 id="changelog">2 Changelog</h3>
<ul>
	<li>March 2, 2011: initial version by <a href="credits.html#erichocean">Erich Ocean</a> and <a href="credits.html#geoffreyd">Geoffrey Donaldson</a></li>
	<li>March 2, 2011: cleanup by <a href="credits.html#pwagenet">Peter Wagenet</a></li>
	<li>March 7, 2011: small bug fixes and filename addition by <a href="credits.html#topherfangio">Topher Fangio</a></li>
</ul>

      </div>
        <div id="subCol">
          <h3 class="chapter"><img src="images/strobe/chapters.png" alt="" />Chapters</h3>
          <ol class="chapters">
            <li><a href="#how-to-use-sproutcore-without-a-model-layer"><p>How To Use SproutCore Without a Model Layer</p>
</a></li><li><a href="#changelog"><p>Changelog</p>
</a></li>
          </ol>
        </div>
    </div>
  </div>

  <hr class="hide" />
	  <footer>
	    <div class="container">
	      <div class="col">
	        <a href="index.html"><img src="images/footer/sc_logo_medium.png" alt="SproutCore" /></a>
	        <p id="license">
	          Copyright 2011 <a href="http://www.strobecorp.com">Strobe Inc</a>.
	          <br />
	          SproutCore framework is under MIT License.
	        </p>
	      </div>
	      <nav class="col">
	        <h1>Site Navigation</h1>
	        <ul>
	          <li><a href="http://www.sproutcore.com/about/">About</a></li>
	          <li><a href="http://sproutcore.com/docs/">Docs</a></li>
	          <li><a href="http://blog.sproutcore.com">Blog</a></li>
	          <li><a href="http://www.sproutcore.com/install/?redirect=1">Download</a></li>
	          <li><a href="http://www.sproutcore.com/community/">Community</a></li>
	          <li><a href="https://github.com/sproutcore/sproutcore">GitHub</a></li>
	          <li><a href="mailto:community@sproutcore.com">Contact Us</a></li>
	          <li><a href="http://sproutcore.com/guides/">Guides</a></li>
	        </ul>
	        <a href="http://www.w3.org/html/logo/"><img src="images/footer/html5_tech.png" alt="HTML5 Powered" /></a>
	      </nav>
	      <div class="col">
	        <h1>Get in Touch, Stay Informed</h1>
	        <ul class="social">
	          <li><a href="http://twitter.com/sproutcore"><img src="images/footer/twitter.png" alt="Twitter" /></a></li>
	          <li><a href="http://www.facebook.com/sproutcore"><img src="images/footer/facebook.png" alt="Facebook" /></a></li>
	          <li><a href="http://groups.google.com/group/sproutcore"><img src="images/footer/google.png" alt="Google Groups" /></a></li>
						<li><a href="http://groups.google.com/group/sproutcore">Subscribe To Mailing List</a></li>
	        </ul>
					<a href="http://eepurl.com/dK1-Y" target="_blank" id="newsletter" class="button secondary">Sign Up For Our Newsletter!</a>
	<!-- Commented out until we have mailchimp API integration.
					<h2>Subscribe To Newsletter</h2>
	        <div id="subscribe">
	          <form>
	            <input type="text" name="email" />
	            <button name="subscribe">Sign-Up</button>
	            <div class="processing"><img src="/img/spinner.gif"></div>
	            <div class="error"></div>
	          </form>
	        </div>
	-->
	      </div>
	      <a href="#feature" class="top">Back To Top</a>
	    </div>
	  </footer>

  <script src="http://code.jquery.com/jquery-1.6.min.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" src="javascripts/sproutGuides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushJScript.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushCss.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all()

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19584397-1']);
    _gaq.push(['_setDomainName', '.sproutcore.com']);
    _gaq.push(['_setAllowHash', false]);
    _gaq.push(['_setAllowLinker', true]);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl': 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body>
</html>
